<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>


        <record id="view_product_template_tree_purchase" model="ir.ui.view">
            <field name="name">product.template.tree</field>
            <field name="model">product.template</field>
            <field name="arch" type="xml">
                <tree string="产品" decoration-danger="forecast_qty&lt;0" decoration-info="forecast_qty&gt;=0">
                    <field name="sequence" widget="handle"/>
                    <field name="default_code" string="料号" readonly="1"/>
                    <button name="view_product_id" type="object" icon="fa-arrow-right"/>
                    <field name="name"/>
                    <field name="list_price" invisible="1"/>
                    <field name="standard_price" invisible="1"/>
                    <field name="categ_id" invisible="1"/>
                    <field name="type" invisible="1"/>
                    <field name="uom_id" invisible="1"/>
                    <field name="active" invisible="1"/>
                    <field name="stock" string="库存"/>
                    <field name="incoming_qty" string="在产"/>
                    <field name="forecast_qty" string="预测数量"/>
                    <field name="reordering_min_qty" string="最小"/>
                    <field name="reordering_max_qty" string="最大"/>
                    <!--<field name="order_point_active" string="订货规则开启"/>-->

                    <field name="last1_month_consume_qty" readonly="1" string="1个月"/>
                    <field name="last3_month_consume_qty" readonly="1" string="3个月"/>
                    <field name="last6_month_consume_qty" readonly="1" string="6个月"/>

                </tree>
            </field>
        </record>
        <record id="purchase.product_normal_action_puchased" model="ir.actions.act_window">
            <!--<field name="name">产品</field>-->
            <!--<field name="type">ir.actions.act_window</field>-->
            <!--<field name="res_model">product.template</field>-->
            <!--<field name="view_type">form</field>-->
            <field name="view_mode">tree,form,kanban</field>
            <field name="context">{"search_default_filter_to_purchase":1, "is_show_procuremnt_create_btn":1,
                "order_type":"purchase"}
            </field>
            <!--<field name="search_view_id" eval="False"/> &lt;!&ndash; Force empty &ndash;&gt;-->
            <field name="view_ids" eval="[(5,0,0),

            (0,0,{'view_mode':'tree', 'view_id': ref('view_product_template_tree_purchase')}),
            (0,0,{'view_mode':'form', 'view_id': False}),
            (0,0,{'view_mode':'kanban', 'view_id': False}),
            ]"/>
            <!--<field name="help" type="html">-->
            <!--<p class="oe_view_nocontent_create">-->
            <!--Click to define a new product.-->
            <!--</p><p>-->
            <!--You must define a product for everything you purchase, whether-->
            <!--it's a physical product, a consumable or services you buy to-->
            <!--subcontractors.-->
            <!--</p><p>-->
            <!--The product form contains detailed information to improve the-->
            <!--purchase process: prices, procurement logistics, accounting data,-->
            <!--available vendors, etc.-->
            <!--</p>-->
            <!--</field>-->
        </record>
        <!-- INHERITED TREE -->
        <record id="view_product_template_tree" model="ir.ui.view">
            <field name="name">product.template.tree.inherit</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_tree_view"/>
            <field name="arch" type="xml">
                <field name="name" position="before">
                    <button name="view_product_id" type="object" icon="fa-arrow-right"/>
                </field>
                <xpath expr="//field[@name='default_code']" position="attributes">
                    <attribute name="string">料号</attribute>
                    <attribute name="readonly">1</attribute>
                </xpath>
                <xpath expr="//field[@name='name']" position="attributes">
                    <attribute name="readonly">1</attribute>
                </xpath>


                <xpath expr="//field[@name='standard_price']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>


                <xpath expr="//field[@name='type']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//field[@name='list_price']" position="attributes">
                    <attribute name="invisible">1</attribute>

                </xpath>


                <xpath expr="//field[@name='categ_id']" position="replace">
                </xpath>
                <xpath expr="//field[@name='uom_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>


                <xpath expr="//field[@name='uom_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//field[@name='uom_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>


                <xpath expr="//field[@name='list_price']" position="attributes">
                    <attribute name="string">售价</attribute>
                </xpath>
                <!--<xpath expr="//page[1]" position="attributes">-->
                <!--<attribute name="string">供应商</attribute>-->
                <!--</xpath>-->
                <xpath expr="//field[@name='virtual_available']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//field[@name='qty_available']" position="replace">
                    <field name="mos_info" invisible="1"/>
                    <field name="outgoing_qty" string="需求"/>
                    <field name="incoming_qty" string="在产" info_field="mos_info" widget="popup_dialog_widget"/>
                    <field name="stock" string="库存"/>
                    <field name="forecast_qty"/>

                    <field name="reordering_min_qty" string="最小"/>
                    <field name="reordering_max_qty" string="最大"/>
                    <!--<field name="order_point_active" string="订货规则开启"/>-->

                    <field name="last1_month_qty" readonly="1" string="1个月"/>
                    <field name="last2_month_qty" readonly="1" string="3个月"/>
                    <field name="last3_month_qty" readonly="1" string="6个月"/>

                </xpath>


            </field>
        </record>

        <!-- INHERITED FORM -->
        <record id="view_product_form_linkloving" model="ir.ui.view">
            <field name="name">product.product.form</field>
            <field name="model">product.product</field>
            <field name="inherit_id" ref="product.product_normal_form_view"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='barcode']" position="before">
                    <label for="street" string="Stock Location"/>
                    <div class="o_address_format">
                        <field name="area_id" class="o_address_city" options="{'no_create':True}"/>
                        <field name="location_x" class="o_address_state" placeholder=""/>
                        <field name="location_y" class="o_address_state" placeholder=""/>
                    </div>

                </xpath>
                <xpath expr="//field[@name='barcode']" position="after">
                    <field name="product_specs"/>
                    <field name="description"/>
                </xpath>
                <xpath expr="//field[@name='categ_id']" position="attributes">
                    <attribute name="options">{'no_create':True}</attribute>
                </xpath>
                <xpath expr="//notebook/page[1]" position="attributes">
                    <attribute name="string">供应商</attribute>

                </xpath>


            </field>
        </record>
        <record id="product_template_form_view_procurement_button_inherit" model="ir.ui.view">
            <field name="name">product.template.form</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="stock.product_template_form_view_procurement_button"/>
            <field name="arch" type="xml">

                <xpath expr="//button[@name='%(stock.action_view_change_product_quantity)d']" position="replace">

                    <button name="%(stock.action_view_change_product_quantity)d" string="更新库存" type="action"
                            attrs="{'invisible': [('type', '!=', 'product')]}"
                            groups="base.group_erp_manager"/>
                    <button string="标记为停产"
                            type="object"
                            class=" btn-primary"
                            groups="stock.group_stock_manager"
                            name="set_to_eol"
                            confirm="确定标记为停产？"
                            attrs="{'invisible': [('status', '=', 'eol')]}"/>
                    <button string="取消标记为停产"
                            type="object"
                            name="cancel_eol"
                            groups="stock.group_stock_manager"
                            attrs="{'invisible': [('status', '!=', 'eol')]}"/>
                    <field name="status" widget="statusbar" statusbar_visible="eol" readonly="1"/>

                </xpath>


            </field>
        </record>


        <record id="view_product_template_form_linkloving" model="ir.ui.view">
            <field name="name">product.template.form</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="stock.product_template_form_view_procurement_button"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='barcode']" position="before">
                    <label for="street" string="Stock Location"/>
                    <div class="o_address_format">
                        <field name="area_id" class="o_address_city" options="{'no_create':True}"/>
                        <field name="location_x" class="o_address_state"/>
                        <field name="location_y" class="o_address_state"/>
                    </div>

                </xpath>
                <xpath expr="//field[@name='barcode']" position="after">
                    <field name="product_specs"/>
                </xpath>
                <xpath expr="//field[@name='default_code']" position="attributes">
                    <attribute name="string">料号</attribute>
                </xpath>
                <xpath expr="//field[@name='categ_id']" position="attributes">
                    <attribute name="options">{'no_create':True}</attribute>
                </xpath>

                <xpath expr="//field[@name='list_price']" position="attributes">
                    <attribute name="string">售价</attribute>

                </xpath>
                <xpath expr="//notebook/page[2]" position="attributes">
                    <attribute name="string">供应商</attribute>

                </xpath>

            </field>
        </record>
        <record id="product_template_search_form_view_stock_inherit" model="ir.ui.view">
            <field name="name">product.template.search.stock.form</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_search_view"/>
            <field name="arch" type="xml">
                <field name="pricelist_id" position="after">

                    <filter name="eol1" string="已停产"
                            domain="['|',('active','=',False),('active','=',True),('status','=','eol')]"/>
                </field>
            </field>
        </record>
        <record id="product_template_search_inherit" model="ir.ui.view">
            <field name="name">product.template.search.form</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_search_view"/>
            <field name="arch" type="xml">
                <field name="pricelist_id" position="after">
                    <filter name="filter_produce" string="有草稿MO的" domain="[('has_draft_mo', '=', True)]"/>
                    <separator/>
                    <filter name="filter_produce" string="有需求确认MO的" domain="[('has_confirmed_mo', '=', True)]"/>
                    <separator/>
                    <filter name="filter_produce" string="有MO在产的" domain="[('has_mo_procure', '=', True)]"/>
                    <separator/>
                    <filter name="filter_in_plan" string="有MO已排产的" domain="[('has_mo_in_plan', '=', True)]"/>
                    <separator/>
                    <filter name="filter_unplan" string="有MO未排产的" domain="[('has_mo_unplan', '=', True)]"/>
                    <separator/>

                    <separator/>
                    <filter name="filter_is_virtual_lt_reordering" string="预测 &lt;最小存货"
                            domain="[('is_virtual_lt_reordering', '=', True)]"/>
                    <separator/>
                    <filter name="filter_is_available_lt_required" string="库存 &lt;订单量"
                            domain="[('is_available_lt_required', '=', True)]"/>
                    <separator/>
                    <filter name="has_bom" string="不有在bom里面" domain="[('has_bom_line_lines', '=', False)]"/>
                </field>

            </field>
        </record>


        <record id="model_product_template_excel_export" model="ir.actions.server">
            <field name="name">导出实时成本</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="state">code</field>
            <field name="code">
                action = {
                'type': 'ir.actions.act_url',
                'url': 'export/product_template?values=' + str(context.get('active_ids', [])),
                'nodestroy': True
                }
            </field>
        </record>

        <record id="action_product_template_excel_export" model="ir.values">
            <field name="name">导出实时成本</field>
            <field name="action_id" ref="linkloving_warehouse.model_product_template_excel_export"/>
            <field name="value"
                   eval="'ir.actions.server,%d' %ref('linkloving_warehouse.model_product_template_excel_export')"/>
            <field name="key">action</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="model">product.template</field>
            <field name="key2">client_action_multi</field>
        </record>
    </data>
</openerp>





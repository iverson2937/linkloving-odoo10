<?xml version="1.0" encoding="UTF-8"?>

<templates xml:space="preserve">
    <t t-name="arrange_production_tmp">
        <div class="arrange_production_container">
            <!--<t t-call="container_header"></t>-->
        </div>
    </t>

    <t t-name="a_p_render_tmpl">
        <div id="a_p_left">
            <div class="a_p_left_head">
                <span style="font-size:15px;margin-left:15px;font-weight:bold;">时间（包含）</span>
                <div class="a_p_time_start"></div>
                <div class="a_p_time_end search_view"></div>
                <div class="order_by">
                    <button class="btn btn-primary order_by_material">根据物料排序</button>
                    <button class="btn btn-primary order_by_default" style="display:none;">根据时间排序</button>
                </div>
            </div>
            <t t-foreach="result" t-as="item">
                <div class="production_line" t-att-data-index="item_index">
                    <span class="p_line_name">产线： <t t-esc="item.name"/></span>
                    <div class="p_line_right">
                        <t t-if="item.employee_id &amp;&amp; item.employee_id.length>0">
                            <div class="responsible">
                                产线负责人：<span><t t-esc="item.employee_id[1]"/></span>
                            </div>
                        </t>
                        <div class="production_qty">
                            MO数量：<span><t t-esc="item.amount_of_planned_mo"/></span>
                        </div>
                        <t t-if="item.equipment_ids &amp;&amp; item.equipment_ids.length">
                            <div class="p_line_equipment">
                                设备：<span><t t-esc="item.equipment_ids.length" /></span>
                            </div>
                        </t>

                        <span class="fa fa-chevron-down a_p_showorhide"></span>
                    </div>
                </div>
                <div class="production_lists_wrap">
                    <t t-if="item.id==-1">
                        <div class="un_group"></div>
                    </t>
                </div>
            </t>
        </div>
    </t>

    <!--未排产-->
    <t t-name="un_a_p_tmpl">
        <div class="production_line un_production_line">
            <span class="p_line_name">未排产</span>
            <div class="p_line_right">
                <div class="production_qty">
                    MO数量：<span><t t-esc="result.length"/></span>
                </div>
                <div class="p_line_equipment">
                    产线时间/总人工时间：<span></span>
                </div>
                <span class="fa fa-chevron-down un_a_p_showorhide"></span>
            </div>
        </div>
        <div class="production_lists_wrap un_a_p_lists_wrap">
            <t t-call="un_a_p_render_right_tmpl"></t>
        </div>
    </t>

    <t t-name="a_p_render_right_tmpl">
        <t t-foreach="result" t-as="item">
            <div class="ap_item_wrap" t-att-id="'id'+item.id" t-att-data-index="item_index" t-att-data-mo-id="item.id" t-att-data-bom-id="item.bom_id[0]" t-att-data-product-id="item.product_tmpl_id[0]">
                <div class="a_p_item_top">
                    <p class="a_p_mo_name"><t t-esc="item.display_name"/></p>
                    <span class="a_p_create_alia">
                        <t t-if="item.alia_name!=false">
                            <t t-esc="item.alia_name"/>
                        </t>
                    </span>
                    <div class="a_p_item_operate_zone">
                        <span class="to_relevant_struc">关联MO</span>
                        <!--<span class="to_so">SO</span>-->
                        <!--<span class="to_bom">BOM</span>-->
                    </div>
                </div>

                <p class="a_p_product_name">
                    <t t-esc="item.bom_id[1]"/>
                </p>
                <span class="a_p_mo_state">
                    <span class="mat" t-att-style='"background:" + item.material_state'>物</span>
                    <span class="pre" t-att-style='"background:" + item.prepare_material_state'>备</span>
                    <t t-foreach="selection" t-as="sel">
                        <t t-if="sel[0] == item.state">
                            <span class="sta"><t t-esc="sel[1]"/></span>
                        </t>
                    </t>
                </span>

                <div class="ap_item_main_left">
                    <span class="a_p_process_res">
                        <t t-if="produce_speed_factor=='equipment'">
                            SOP设备数: <t t-esc="item.theory_factor"/>
                        </t>
                        <t t-else="">
                            SOP员工数: <t t-esc="item.theory_factor"/>
                        </t>
                    </span>
                    <t t-if="show_more">
                        <t t-if="item.produce_speed_factor == 'human'">
                            <span class="a_p_spend_time">理论人数: <t t-esc="item.theory_factor"/>人</span>
                        </t>
                        <span class="a_p_spend_time">数量（完成/需求）：<t t-esc="item.ava_spent_time"/>h / <t t-esc="item.real_theo_spent_time"/>h</span>
                    </t>

                </div>
                <div class="ap_item_new_add">
                    <span>理论工时（产线/总工时）：<t t-esc="item.ava_spent_time"/>/<t t-esc="item.real_theo_spent_time"/> </span>
                </div>
                <div class="ap_item_main_center">
                    <t t-js="ctx">
                        function change_time(date_planned){

                            date_planned = date_planned.replace(/\s/g,'T').replace(/\//g,'-');
                            var my_date = Date.parse(new Date(date_planned))
                            var newDate = new Date();
                            var time_offset = newDate.getTimezoneOffset() * 60000
                            var c_date = new Date(my_date - time_offset)
                            return moment(c_date).format('YYYY-MM-DD HH:mm:ss');
                        }
                        if (ctx.item.date_planned_start){
                            ctx.item.date_planned_start = change_time(ctx.item.date_planned_start);
                        }
                        if (ctx.item.date_planned_finished){
                            ctx.item.date_planned_finished = change_time(ctx.item.date_planned_finished);
                        }
                        if (ctx.item.planned_start_backup){
                            ctx.item.planned_start_backup = change_time(ctx.item.planned_start_backup);
                        }
                    </t>
                    <span class="a_p_latest_time">最晚开始：
                        <t t-if="item.planned_start_backup == false">
                            暂无时间
                        </t>
                        <t t-else="">
                            <t t-esc="item.planned_start_backup"/>
                        </t>
                    </span>
                    <t t-if="show_more">
                        <span class="a_p_forecast_start">预计开始：<t t-esc="item.date_planned_start" /></span>
                        <span class="a_p_forecast_end">预计结束：<t t-esc="item.date_planned_finished" /></span>
                    </t>
                </div>

            </div>
        </t>
    </t>

    <t t-name="un_a_p_render_right_tmpl">
        <div class="a_p_right_head">

        </div>
        <t t-foreach="result" t-as="item">
            <div class="ap_item_wrap" t-att-id="'id'+item.id" t-att-data-index="item_index" t-att-data-mo-id="item.id" t-att-data-bom-id="item.bom_id[0]" t-att-data-product-id="item.product_tmpl_id[0]">
                <div class="a_p_item_top">
                    <p class="a_p_mo_name"><t t-esc="item.display_name"/></p>
                    <span class="a_p_create_alia">
                        <t t-if="item.alia_name!=false">
                            <t t-esc="item.alia_name"/>
                        </t>
                    </span>
                    <div class="a_p_item_operate_zone">
                        <span class="to_relevant_struc">关联MO</span>
                    </div>
                </div>

                <p class="a_p_product_name">
                    <t t-esc="item.bom_id[1]"/>
                </p>
                <span class="a_p_mo_state">
                    <span class="mat" t-att-style='"background:" + item.material_state'>物</span>
                    <span class="pre" t-att-style='"background:" + item.prepare_material_state'>备</span>
                    <t t-foreach="selection" t-as="sel">
                        <t t-if="sel[0] == item.state">
                            <span class="sta"><t t-esc="sel[1]"/></span>
                        </t>
                    </t>
                </span>

                <div class="ap_item_main_left">
                    <span class="a_p_process_res">
                        <t t-if="produce_speed_factor=='equipment'">
                            SOP设备数: <t t-esc="item.theory_factor"/>
                        </t>
                        <t t-else="">
                            SOP员工数: <t t-esc="item.theory_factor"/>
                        </t>
                    </span>
                </div>
                <div class="ap_item_new_add">
                    <span class="a_p_spend_time">数量（完成/需求）：<t t-esc="item.qty_unpost"/> / <t t-esc="item.product_qty"/></span>
                </div>
                <div class="ap_item_main_center">
                    <t t-js="ctx">
                        function change_time(date_planned){

                            date_planned = date_planned.replace(/\s/g,'T').replace(/\//g,'-');
                            var my_date = Date.parse(new Date(date_planned))
                            var newDate = new Date();
                            var time_offset = newDate.getTimezoneOffset() * 60000
                            var c_date = new Date(my_date - time_offset)
                            return moment(c_date).format('YYYY-MM-DD HH:mm:ss');
                        }
                        if (ctx.item.date_planned_start){
                            ctx.item.date_planned_start = change_time(ctx.item.date_planned_start);
                        }
                        if (ctx.item.date_planned_finished){
                            ctx.item.date_planned_finished = change_time(ctx.item.date_planned_finished);
                        }
                        if (ctx.item.planned_start_backup){
                            ctx.item.planned_start_backup = change_time(ctx.item.planned_start_backup);
                        }
                    </t>
                    <span class="a_p_latest_time">最晚开始：
                        <t t-if="item.planned_start_backup == false">
                            暂无时间
                        </t>
                        <t t-else="">
                            <t t-esc="item.planned_start_backup"/>
                        </t>
                    </span>
                </div>

            </div>
        </t>
    </t>
</templates>